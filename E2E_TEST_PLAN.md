# E2E –¢–µ—Å—Ç –ü–ª–∞–Ω: Plan ‚Üí Act Workflow

## –°–≤–æ–¥–∫–∞
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –ø–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç: –¢–∏–ø—ã –∏ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

- [ ] **–¢–∏–ø—ã PendingPlan**: –ø—Ä–æ—á–∏—Ç–∞—Ç—å [src/lib/types.ts:146-151](src/lib/types.ts#L146-L151)
  - ‚úì `id: string` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–ª–∞–Ω–∞
  - ‚úì `planName, description, todos` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∞

- [ ] **–¢–∏–ø—ã PendingPlanTodo**: [src/lib/types.ts:132-144](src/lib/types.ts#L132-L144)
  - ‚úì `status?: 'pending' | 'done' | 'failed'` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  - ‚úì `resultSummary?: string` - –∫—Ä–∞—Ç–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–º–∞–∫—Å 800 —Å–∏–º–≤–æ–ª–æ–≤)
  - ‚úì `startedAt?, finishedAt?: number` - timestamps

- [ ] **–¢–∏–ø—ã StepRunResult**: [src/lib/types.ts:154-163](src/lib/types.ts#L154-L163)
  - ‚úì `resultSummary: string` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
  - ‚úì `artifacts?: string[]` - –ø—É—Ç–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
  - ‚úì `todoUpdate?: { done: boolean, notes?: string }` - —Å—Ç–∞—Ç—É—Å –¥–ª—è TODO
  - ‚úì `errors?: string[]` - —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç: buildPlanFromInput

**–§–∞–π–ª**: [src/lib/services/PlanManager.ts:179-247](src/lib/services/PlanManager.ts#L179-L247)

- [ ] **–°—Ç–∞—Ç—É—Å –ø–µ—Ä–µ—Ö–æ–¥**: 'planning' ‚Üí 'ready'
  - ‚úì –°—Ç—Ä–æ–∫–∞ 187: `deps.store?.setPlanStatus('planning')`
  - ‚úì –°—Ç—Ä–æ–∫–∞ 245: `deps.store?.setPlanStatus('ready')`
  - ‚úì –°—Ç—Ä–æ–∫–∞ 251: `deps.store?.setPlanStatus('ready')` –ø—Ä–∏ –æ—à–∏–±–∫–µ

- [ ] **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**
  - ‚úì –í—ã–∑—ã–≤–∞–µ—Ç `normalizePlan(parsedData)` (—Å—Ç—Ä–æ–∫–∞ 242)
  - ‚úì `normalizePlan` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `plan.id` –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç (—Å—Ç—Ä–æ–∫–∞ 23: `plan_${Date.now()}_${random}`)
  - ‚úì –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `status = 'pending'` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ (—Å—Ç—Ä–æ–∫–∞ 37)

- [ ] **–í–∞–ª–∏–¥–∞—Ü–∏—è**
  - ‚úì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—É—Å—Ç–æ–π input (—Å—Ç—Ä–æ–∫–∞ 183)
  - ‚úì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É JSON (—Å—Ç—Ä–æ–∫–∞ 233)
  - ‚úì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ todos array (—Å—Ç—Ä–æ–∫–∞ 237)
  - ‚úì FAIL-FAST: –±—Ä–æ—Å–∞–µ—Ç –æ—à–∏–±–∫—É, –Ω–µ —Å–∫—Ä—ã–≤–∞–µ—Ç (—Å—Ç—Ä–æ–∫–∞ 252)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç: executePlan

**–§–∞–π–ª**: [src/lib/services/PlanManager.ts:269-466](src/lib/services/PlanManager.ts#L269-L466)

- [ ] **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ resumption**
  - ‚úì –ü–∞—Ä–∞–º–µ—Ç—Ä `startIndex = 0` (—Å—Ç—Ä–æ–∫–∞ 272)
  - ‚úì –¶–∏–∫–ª: `for (let i = startIndex; i < plan.todos.length; i++)` (—Å—Ç—Ä–æ–∫–∞ 289)

- [ ] **–î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ (Lines 300-410)**:
  - ‚úì –°–æ–±–∏—Ä–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é: `plan.todos.slice(0, i).filter(t => t.status === 'done')` (—Å—Ç—Ä–æ–∫–∞ 306-309)
  - ‚úì –í—ã–∑—ã–≤–∞–µ—Ç `deps.contextBuilder()` —Å try/catch (—Å—Ç—Ä–æ–∫–∞ 313-320)
  - ‚úì –°–æ–∑–¥–∞—ë—Ç `buildStepPrompt()` —Å –ø–ª–∞–Ω–æ–º + –∏—Å—Ç–æ—Ä–∏–µ–π + –ø—Ä–∞–≤–∏–ª–∞–º–∏ (—Å—Ç—Ä–æ–∫–∞ 323-336)
  - ‚úì –¢—Ä–µ–±—É–µ—Ç JSON `StepRunResult` –≤ –æ—Ç–≤–µ—Ç–µ (—Å—Ç—Ä–æ–∫–∞ 339-350)
  - ‚úì –ü–∞—Ä—Å–∏—Ç JSON –±–µ–∑–æ–ø–∞—Å–Ω–æ —á–µ—Ä–µ–∑ `extractJsonBlock()` (—Å—Ç—Ä–æ–∫–∞ 344)
  - ‚úì –û–±–Ω–æ–≤–ª—è–µ—Ç `step.status, resultSummary, timestamps` (—Å—Ç—Ä–æ–∫–∞ 374-377)
  - ‚úì –í—ã–∑—ã–≤–∞–µ—Ç `deps.todo.updateFromStep()` (—Å—Ç—Ä–æ–∫–∞ 380-387)
  - ‚úì –°–æ–∑–¥–∞—ë—Ç savepoint —á–µ—Ä–µ–∑ `deps.savePoints.create()` (—Å—Ç—Ä–æ–∫–∞ 390-406)
  - ‚úì –û–±–Ω–æ–≤–ª—è–µ—Ç `setCurrentStepIndex(i + 1)` (—Å—Ç—Ä–æ–∫–∞ 409)

- [ ] **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
  - ‚úì –ü–æ–º–µ—á–∞–µ—Ç —à–∞–≥ –∫–∞–∫ 'failed' (—Å—Ç—Ä–æ–∫–∞ 418)
  - ‚úì –°–æ—Ö—Ä–∞–Ω—è–µ—Ç errorSavePoint (—Å—Ç—Ä–æ–∫–∞ 422-441)
  - ‚úì currentStepIndex –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ —à–∞–≥–µ —Å –æ—à–∏–±–∫–æ–π –¥–ª—è —Ä–µ—Ç—Ä–∞—è (—Å—Ç—Ä–æ–∫–∞ 444)
  - ‚úì –ú—è–≥–∫–∞—è –æ—Ç–º–µ–Ω–∞: AbortSignal —Å—Ç–∞–≤–∏—Ç —Å—Ç–∞—Ç—É—Å 'ready' (—Å—Ç—Ä–æ–∫–∞ 329-331)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç: ModeOrchestrator Integration

**–§–∞–π–ª**: [src/components/orchestrator/ModeOrchestrator.tsx](src/components/orchestrator/ModeOrchestrator.tsx)

### handlePlanMode (Plan-—Ä–µ–∂–∏–º)

- [ ] **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞** (—Å—Ç—Ä–æ–∫–∞ 207-232)
  - ‚úì –í—ã–∑—ã–≤–∞–µ—Ç `buildPlanFromInput(text, deps)` (—Å—Ç—Ä–æ–∫–∞ 222)
  - ‚úì –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ store: `storeSetPendingPlan(newPlan)` (—Å—Ç—Ä–æ–∫–∞ 223)
  - ‚úì –°—Ç–∞–≤–∏—Ç `storeSetAwaitingConfirmation(true)` (—Å—Ç—Ä–æ–∫–∞ 224)
  - ‚úì –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–ª–∞–Ω –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

- [ ] **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–∞** (—Å—Ç—Ä–æ–∫–∞ 139-156)
  - ‚úì –ü—Ä–∏ "–¥–∞": —Å–æ–∑–¥–∞—ë—Ç TODO —Å–ø–∏—Å–æ–∫ —Å —à–∞–≥–∞–º–∏ –ø–ª–∞–Ω–∞
  - ‚úì –î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `todo.addTodoItem()` —Å –¥–µ—Ç–∞–ª—è–º–∏
  - ‚úì –û–±–Ω—É–ª—è–µ—Ç –ø–ª–∞–Ω—ã: `storeSetPendingPlan(null), storeSetAwaitingConfirmation(false)`

- [ ] **–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞** (—Å—Ç—Ä–æ–∫–∞ 160-163)
  - ‚úì –ü—Ä–∏ "–Ω–µ—Ç": –æ—á–∏—â–∞–µ—Ç pending plan
  - ‚úì –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–Ω

- [ ] **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞** (—Å—Ç—Ä–æ–∫–∞ 166-204)
  - ‚úì –ü—Ä–∏ "–∏–∑–º–µ–Ω–µ–Ω–∏—è: ...": –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–ª–∞–Ω —á–µ—Ä–µ–∑ LLM
  - ‚úì –°–Ω–æ–≤–∞ —Å—Ç–∞–≤–∏—Ç –≤ —Ä–µ–∂–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### handleActMode (Act-—Ä–µ–∂–∏–º)

- [ ] **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** (—Å—Ç—Ä–æ–∫–∞ 244-257)
  - ‚úì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `pendingPlan` (—Å—Ç—Ä–æ–∫–∞ 246)
  - ‚úì –ë–µ—Ä—ë—Ç `startIndex` –∏–∑ `store.currentStepIndex` –¥–ª—è resumption (—Å—Ç—Ä–æ–∫–∞ 251)
  - ‚úì –°–æ–∑–¥–∞—ë—Ç `AbortController` –¥–ª—è –æ—Ç–º–µ–Ω—ã (—Å—Ç—Ä–æ–∫–∞ 257)

- [ ] **–°–±–æ—Ä–∫–∞ deps** (—Å—Ç—Ä–æ–∫–∞ 260-332)
  - ‚úì llm.askQuestion (—Å—Ç—Ä–æ–∫–∞ 262)
  - ‚úì modelId (—Å—Ç—Ä–æ–∫–∞ 264)
  - ‚úì savePoints.create: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ store (—Å—Ç—Ä–æ–∫–∞ 265-273)
  - ‚úì todo.updateFromStep: –æ–±–Ω–æ–≤–ª—è–µ—Ç TODO —Å–ø–∏—Å–æ–∫ (—Å—Ç—Ä–æ–∫–∞ 275-291)
  - ‚úì store.setPlanStatus/setCurrentStepIndex (—Å—Ç—Ä–æ–∫–∞ 294-302)
  - ‚úì logger: console.log/error (—Å—Ç—Ä–æ–∫–∞ 304-306)
  - ‚úì signal: –∏–∑ AbortController (—Å—Ç—Ä–æ–∫–∞ 308)
  - ‚úì workRulesText: —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (—Å—Ç—Ä–æ–∫–∞ 309)
  - ‚úì contextBuilder: —Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å graceful fallback (—Å—Ç—Ä–æ–∫–∞ 310-332)
  - ‚úì callbacks: onStepStart/Done/Error (—Å—Ç—Ä–æ–∫–∞ 333-343)

- [ ] **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** (—Å—Ç—Ä–æ–∫–∞ 344-351)
  - ‚úì –í—ã–∑—ã–≤–∞–µ—Ç `await executePlan(pendingPlan, deps, startIndex)` (—Å—Ç—Ä–æ–∫–∞ 344)
  - ‚úì –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
  - ‚úì –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ: —Å–æ–æ–±—â–µ–Ω–∏–µ —Å hint –æ resumption
  - ‚úì –ü—Ä–∏ –æ—à–∏–±–∫–µ: —Å–æ–æ–±—â–µ–Ω–∏–µ —Å errorMsg

---

## üß™ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π E2E –¢–µ—Å—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ë–∞–∑–æ–≤—ã–π –ø–ª–∞–Ω ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–®–∞–≥–∏:**
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ —Ä–µ–∂–∏–º **PLAN**
2. –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å: "–°–æ–∑–¥–∞–π –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ 3 —à–∞–≥–æ–≤"
3. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω —Å —à–∞–≥–∞–º–∏
4. –û—Ç–≤–µ—Ç—å—Ç–µ: "–¥–∞"
5. ‚úÖ –î–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å TODO —Å–ø–∏—Å–æ–∫
6. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ —Ä–µ–∂–∏–º **ACT**
7. –í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
8. ‚úÖ –î–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è —à–∞–≥–∏ –ø–æ –æ–¥–Ω–æ–º—É, —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ todo –∏ savepoints

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ü–ª–∞–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç id (`plan_${timestamp}_${random}`)
- [ ] –ö–∞–∂–¥—ã–π —à–∞–≥ –∏–º–µ–µ—Ç status='pending' –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
- [ ] –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–∞: status='done', resultSummary –∑–∞–ø–æ–ª–Ω–µ–Ω, timestamps —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] TODO —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- [ ] Savepoints —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ store

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—à–∏–±–∫–∞ –≤ —à–∞–≥–µ

**–®–∞–≥–∏:**
1. –í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞, –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞
2. ‚úÖ –î–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è errorSavePoint —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
3. –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Å—Ç–∞—Ç—É—Å 'ready'
4. currentStepIndex —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ—à–∏–±–æ—á–Ω—ã–π —à–∞–≥
5. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ –≤–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç
6. ‚úÖ –î–æ–ª–∂–Ω–æ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å—Å—è —Å —ç—Ç–æ–≥–æ –∂–µ —à–∞–≥–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] Step.status = 'failed' –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏
- [ ] currentStepIndex –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –æ—à–∏–±–æ—á–Ω–æ–º —à–∞–≥–µ
- [ ] –ú–æ–∂–Ω–æ —Ä–µ—Ç—Ä–∞—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç–º–µ–Ω–∞ (Cancel)

**–®–∞–≥–∏:**
1. –í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞ –Ω–∞–∂–º–∏—Ç–µ Cancel (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞)
2. ‚úÖ AbortController.abort() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
3. Status –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ 'ready'
4. currentStepIndex —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –¥–ª—è resumption
5. ‚úÖ –ú–æ–∂–Ω–æ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å, –≤–≤–µ–¥—è —Ç–µ–∫—Å—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] AbortSignal.aborted = true
- [ ] executePlan –ª–æ–≤–∏—Ç —ç—Ç–æ –∏ –º—è–≥–∫–æ –≤—ã—Ö–æ–¥–∏—Ç
- [ ] Status = 'ready', –Ω–µ 'error'

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Console (DevTools)

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å pendingPlan –≤ store
useModeOrchestratorStore.getState().chat.pendingPlan
// –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç —Å: { id: "plan_...", planName, todos: [...], todos[0].status = "pending" –∏–ª–∏ "done" }

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å currentStepIndex
useModeOrchestratorStore.getState().chat.currentStepIndex
// –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ >= 0

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å savePoints
useModeOrchestratorStore.getState().chat.savePoints
// –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ SavePoint —Å description –∏ data.pendingPlan
```

---

## üìã –°–≤–æ–¥–∫–∞: –ö–æ–≥–¥–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

‚úÖ **–ï—Å–ª–∏ –≤—Å–µ —á–µ–∫-–ª–∏—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã:**
1. –¢–∏–ø—ã –≤—Å—ë —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç
2. buildPlanFromInput –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç id –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –ø–ª–∞–Ω
3. executePlan –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã, —Å–æ–∑–¥–∞—ë—Ç savepoints, –æ–±–Ω–æ–≤–ª—è–µ—Ç todo
4. handlePlanMode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç buildPlanFromInput
5. handleActMode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç executePlan —Å –ø–æ–ª–Ω—ã–º deps
6. E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

**–ü–ª–∞–Ω ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –ø–æ—à–∞–≥–æ–≤–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å —Å–µ–π–≤–ø–æ–∏–Ω—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!**

---

## üöß –ë—É–¥—É—â–µ–µ (Nice to Have)

- [ ] UI –∫–Ω–æ–ø–∫–∞ **Cancel** –¥–ª—è –≤—ã–∑–æ–≤–∞ `abortControllerRef.current.abort()`
- [ ] Progress bar: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å currentStepIndex / todos.length
- [ ] History —Å–≤–æ–¥–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å resultSummary –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —à–∞–≥–æ–≤ –ø–µ—Ä–µ–¥ —Ç–µ–∫—É—â–∏–º
- [ ] usePlanExecution hook: —Ç–æ–Ω–∫–∞—è –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å
- [ ] Retry UI: –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–µ—Ç—Ä–∞—è —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
